local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

-- –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π
local Proxy = require(ReplicatedStorage:WaitForChild("Shared"):WaitForChild("include"):WaitForChild("Proxy"))
local Sync = require(ReplicatedStorage:WaitForChild("Shared"):WaitForChild("include"):WaitForChild("Sync"))

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
local function tableSize(tbl)
    local count = 0
    for _ in pairs(tbl) do
        count += 1
    end
    return count
end

-- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
local PlayerData = {
    Money = 1000,
    Inventory = {},
    Pets = {}
}

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
Players.PlayerAdded:Connect(function(player)
    local proxyTable = Proxy.observe(PlayerData, function(path, oldValue, newValue)
        print(`[SERVER] üåç –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ –ø—É—Ç–∏ '{table.concat(path, " ‚Üí ")}'`)
        print(`    –°—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {tostring(oldValue)}`)
        print(`    –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {tostring(newValue)}`)
    end)
    
    local sync = Sync.Server.new(proxyTable, player)
    
    -- –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    task.spawn(function()
        local counter = 1
        while player.Parent do
            task.wait(10)
            print(`\n[SERVER] ‚è∞ –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ #{counter}...`)
            
            print("[SERVER] üì¶ –ù–∞—á–∞–ª–æ –ø–∞–∫–µ—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏")
            Proxy.batch(proxyTable, function()

                local newItem = {
                    id = "item_" .. os.time() .. "_" .. counter,
                    name = "Item #" .. counter,
                    rarity = math.random(1, 5)
                }
                Proxy.insert(proxyTable.Inventory, 1, newItem)

                local petId = "pet_" .. counter
                proxyTable.Pets[petId] = {
                    id = petId,
                    name = "Pet #" .. counter,
                    level = counter,
                    type = math.random() > 0.5 and "dragon" or "wolf"
                }
                print(`[SERVER] üêâ –ü–∏—Ç–æ–º–µ—Ü –¥–æ–±–∞–≤–ª–µ–Ω: {petId} - {proxyTable.Pets[petId].name}`)
            end)
            print("[SERVER] ‚úÖ –ü–∞–∫–µ—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
            print("[SERVER] üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:", proxyTable)
            counter += 1
        end
        
        sync:destroy()
    end)
end)