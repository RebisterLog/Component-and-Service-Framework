local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π
local Proxy = require(ReplicatedStorage:WaitForChild("Shared"):WaitForChild("include"):WaitForChild("Proxy"))
local Sync = require(ReplicatedStorage:WaitForChild("Shared"):WaitForChild("include"):WaitForChild("Sync"))

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
local function tableSize(tbl)
    local count = 0
    for _ in pairs(tbl) do
        count += 1
    end
    return count
end

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Ç–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ __source
local function safePairs(tbl)
    local keys = {}
    for k in pairs(tbl) do
        if k ~= "__source" then
            table.insert(keys, k)
        end
    end
    local i = 0
    return function()
        i = i + 1
        if i <= #keys then
            local k = keys[i]
            return k, tbl[k]
        end
    end
end

local LocalData = {
    Money = 0,
    Inventory = {},
    Pets = {}
}

local proxyTable = Proxy.observe(LocalData, function(path, oldValue, newValue)
    print(`[CLIENT] üåç –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ –ø—É—Ç–∏ '{table.concat(path, " ‚Üí ")}'`)
end)

print("[CLIENT] üöÄ –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—É—â–µ–Ω –∏ –æ–∂–∏–¥–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...")
task.wait(1)
local sync = Sync.Client.new(proxyTable)

-- –ü–æ–¥–ø–∏—Å–∫–∏
local moneySubscription = Proxy.subscribe(proxyTable, "Money", function(oldValue, newValue)
    print(`[CLIENT] üí∞ –î–µ–Ω—å–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: {oldValue} ‚Üí {newValue}`)
end)

local inventorySubscription = Proxy.subscribe(proxyTable, "Inventory", function(oldValue, newValue)
    -- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–±–µ–∑ __source)
    local count = 0
    for _ in safePairs(newValue) do
        count += 1
    end
    print(`[CLIENT] üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –æ–±–Ω–æ–≤–ª–µ–Ω. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤: {count}`)
    
    -- –í—ã–≤–æ–¥–∏–º —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã
    for i = 1, #newValue do
        local item = newValue[i]
        if item and item.name then
            print(`    [ITEM {i}] {item.name} (—Ä–µ–¥–∫–æ—Å—Ç—å: {item.rarity})`)
        end
    end
end)

local petsSubscription = Proxy.subscribe(proxyTable, "Pets", function(oldValue, newValue)
    print(`[CLIENT] üêâ –ü–∏—Ç–æ–º—Ü—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã.`, newValue)
end)